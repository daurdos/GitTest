<archimate:ApplicationComponent
    xmlns:archimate="http://www.archimatetool.com/archimate"
    name="MDM_IDEAL_CLIENT_WORK"
    id="id-a45531de54294e7899f493908a00c7d6"
    documentation="Состав пакета MDM_IDEAL_CLIENT_WORK:&#xD;&#xA;- calc_NAT &#xD;&#xA;- Определение Аналитического Клиента;&#xD;&#xA;- calc_NLI_DS &#xD;&#xA;- Определение Золотой Записи;&#xD;&#xA;- calc_DPP &#xD;&#xA;- Определение реквизитов ФИО Золотой Записи;&#xD;&#xA;- calc_FPL &#xD;&#xA;- Определение простого реквизита Золотой Записи со списком допустимых значений;&#xD;&#xA;- calc_FPV &#xD;&#xA;- Определение простого реквизита Золотой Записи;&#xD;&#xA;- calc_FPEL &#xD;&#xA;- Определение значения элемента составного реквизита Золотой Записи со списком допустимых значений;&#xD;&#xA;- calc_FPEV &#xD;&#xA;- Определение значения элемента составного реквизита Золотой Записи. &#xD;&#xA;&#xD;&#xA;Описание работы процедуры «calc_NAT» (Определение Аналитического Клиента, таблица «nl_ansubject»).&#xD;&#xA;&#xD;&#xA;Аналитический Клиент – абстрактный клиент, служит для объединения субъектов, выгруженных из Систем Источников в одну сущность, на основе этого клиента формируется ИК (Золотая запись). Аналитический клиент один и состоит как из одного, так и из многих субъектов Систем Источников.&#xD;&#xA;&#xD;&#xA;В данном модуле, согласно алгоритму, выбираются ключи и ранг СИ субъектов, загруженных на текущий день. К этим данным подтягиваются такие же данные по клиентам, загруженные ранее. Устанавливается связь между существующими Аналитическими клиентами и Идеальными клиентами (Золотыми записями). Связь устанавливается через ключ.&#xD;&#xA;&#xD;&#xA;На следующем этапе определяется, к какому АК и ИК, выгруженный субъект относится. Если такая связь устанавливается, то новый клиент вписывается в эту группу, если же нет – то создается новый Аналитический клиент и затем новый ИК (Золотая Запись). Если у новых выгруженных из разных Систем Источников клиентов ключи совпадают, то по правилу иерархии Систем Источников (таблица «det_system») Аналитическому Клиенту присваивается ID субъекта Системы Источника с наименьшим значением ранга.&#xD;&#xA;&#xD;&#xA;Данное правило было введено при проектировании системы МДМ и служило для того, чтобы выбирать Систему Источник с наибольшей полнотой и правильностью заведенных данных/реквизитов по клиентам.&#xD;&#xA;&#xD;&#xA;При работе алгоритма используются справочники:&#xD;&#xA;- det_system (определение рангов Систем Источников);&#xD;&#xA;- fct_subjattr (таблица с ключами субъектов, выгруженными из Систем Источников);&#xD;&#xA;&#xD;&#xA;Схематично связь между клиентами из СИ, АК и ИК (Золотыми записями) можно изобразить так:&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;Описание работы процедуры «calc_NLI_DS» (Определение Золотой Записи, таблицы «nl_idealsubject» и «det_subject»).&#xD;&#xA;&#xD;&#xA;Золотая Запись – эталонная запись собранная/объединенная из выгруженных субъектов, содержащая в себе актуальные данные по клиентам. После того, как определили/создали Аналитического клиента – создаем Золотую Запись.&#xD;&#xA;&#xD;&#xA;В данном алгоритме проверяем связанны ли все Аналитические Клиенты со своими Золотыми Записями, если хоть у одного Аналитического Клиента нет этой связи, то для него создается новая Золотая Запись.&#xD;&#xA;У каждого Аналитического Клиента – только одна Золотая Запись, Аналитического Клиента без Золотой Записи  не должно быть. Данная связь фиксируется в таблице «nl_idealsubject», код Золотой Записи помещается в таблицу «det_subject», там же хранятся коды субъектов, выгруженных из Систем Источников.&#xD;&#xA;&#xD;&#xA;Описание работы процедуры «calc_DPP» (Определение реквизитов ФИО Золотой Записи, таблица «det_phyz_person»).&#xD;&#xA;&#xD;&#xA;На данном этапе выбирается ФИО для Золотой Записи.&#xD;&#xA;Алгоритм состоит из следующих шагов: выбираются данные по ФИО субъектов, выгруженные за текущий день. Определяются ранее созданные Аналитические Клиенты для этих записей и устанавливается связь с Золотой Записью. Дальше к ним подтягиваются данные по ФИО Золотой Записи, если они существуют.  &#xD;&#xA;&#xD;&#xA;Сравниваются данные. Если окажется, что у Золотой Записи уже существовали ранее эти данные (ФИО), то проверяется на сколько они актуальные, сравнение происходит по дате (поле DT_REG). Затем более свежие обновляют текущие данные, если пришедшие данные оказываются более старыми, то они игнорируются. &#xD;&#xA;В случае, когда у Золотой Записи отсутствуют данные, они добавляются. Если новые данные пришли из нескольких Систем Источников, то среди них выбираются данные (ФИО) из Системы Источника с наименьшим рангом, эти данные идут на вставку в Золотую Запись.&#xD;&#xA;&#xD;&#xA;Описание работы процедуры «calc_FPL» (Определение простого реквизита Золотой Записи со списком допустимых значений, таблица «fct_property_listvalue»).&#xD;&#xA;&#xD;&#xA;На данном этапе выбирается простой реквизит для Золотой Записи со списком допустимых значений. Список простых реквизитов приведен в разделе «2. Схема организации данных».&#xD;&#xA;&#xD;&#xA;Алгоритм выбора аналогичен с выбором ФИО Золотой Записи.&#xD;&#xA;При работе алгоритма используются справочники:&#xD;&#xA;- det_property_value;&#xD;&#xA;- det_form_property.&#xD;&#xA;Связь этих справочников с таблицей можно посмотреть на схеме данных пункт 2. «Схема организации данных».&#xD;&#xA;&#xD;&#xA;Описание работы процедуры «calc_FPV» (Определение простого реквизита Золотой Записи, таблица «fct_property_value»).&#xD;&#xA;&#xD;&#xA;На данном этапе выбирается простой реквизит Золотой Записи. Список простых реквизитов приведен в разделе 2. «Схема организации данных». Алгоритм выбора аналогичен с выбором ФИО Золотой Записи.&#xD;&#xA;&#xD;&#xA;Описание работы процедуры «calc_FPEL» (Определение значения элемента составного реквизита Золотой Записи со списком допустимых значений, таблица «fct_property_elem_listvalue»).&#xD;&#xA;&#xD;&#xA;На данном этапе выбирается значение элемента составного реквизита Золотой Записи со списком допустимых значений. Списки элементов составных реквизитов приведены в разделе «2. Схема организации данных».&#xD;&#xA;&#xD;&#xA;Алгоритм выбора аналогичен с выбором ФИО Золотой Записи.&#xD;&#xA;При работе алгоритма используются справочники:&#xD;&#xA;- det_property_elem_value;&#xD;&#xA;- det_form_property_elem;&#xD;&#xA;- det_form_property.&#xD;&#xA;Связь этих справочников с таблицей приведена в разделе «2. Схема организации данных».&#xD;&#xA;&#xD;&#xA;Описание работы процедуры «calc_FPEV» (Определение значения элемента составного реквизита Золотой Записи, таблица «fct_property_elem_value»).&#xD;&#xA;&#xD;&#xA;На данном этапе выбирается значение элемента составного реквизита Золотой Записи.&#xD;&#xA;Списки элементов составных реквизитов приведены в разделе 2. «Схема организации данных».&#xD;&#xA;Алгоритм выбора аналогичен с выбором ФИО Золотой Записи.&#xD;&#xA;При работе алгоритма используются справочники:&#xD;&#xA;- det_form_property_elem;&#xD;&#xA;- det_form_property.&#xD;&#xA;Связь этих справочников с таблицей приведены в разделе 2. «Схема организации данных».&#xD;&#xA;&#xD;&#xA;Исключения при работе алгоритмов расчета реквизитов Золотой Записи.&#xD;&#xA;Существует таблица справочник «det_field_not_load», если в эту таблицу поместить код реквизита, то данный реквизит не будет рассчитываться. Этим механизмом можно воспользоваться, если для реквизита требуются особый способ расчёта (Пример: реквизит «Сегмент»).&#xD;&#xA;&#xD;&#xA;Расчёт признаков активности, аффилированности, сегмента ИК.&#xD;&#xA;&#xD;&#xA;Расчёт данных реквизитов для ИК заключается в выборе значения с наибольшим приоритетом среди актуальных значений реквизита каждого привязанного к ИК субъекта DWH. Последовательность этой выборки описана ниже.&#xD;&#xA;&#xD;&#xA;1. Осуществляется поиск ИК, к которым привязаны субъекты DWH, у которых есть значение реквизита из новых порций данных, либо у которых появился/обновился Ключ (см. раздел «Расчёт Ключа субъекта»).&#xD;&#xA;2. По каждому такому ИК, выбираются все привязанные к нему субъекты DWH, у которых в DWH есть значения данного реквизита.&#xD;&#xA;3. Выбирается по одному значению реквизита (с наибольшей датой актуальности) на каждого такого субъекта DWH.&#xD;&#xA;4. Из найденных выше значений реквизита у субъектов DWH, привязанных к одному ИК, для ИК выбирается то значение, у которого больший приоритет, согласно справочнику приоритетов значений реквизитов (DWH.MDM_PROP_VAL_RANK).&#xD;&#xA;&#xD;&#xA;Расчёт мобильных телефонов ИК.&#xD;&#xA;&#xD;&#xA;Для удобства восприятия текста вместо понятия «номер мобильного телефона» ниже будет использоваться сокращение «мобильник».&#xD;&#xA;&#xD;&#xA;В MDM хранится следующая информация по мобильникам:&#xD;&#xA;•&#x9;владелец (субъект DWH  или ИК),&#xD;&#xA;•&#x9;порядковый номер мобильника,&#xD;&#xA;•&#x9;номер мобильного телефона,&#xD;&#xA;•&#x9;вид использования (например, СМС-информирование об операции из какой-нибудь СИ),&#xD;&#xA;•&#x9;дата создания/изменения/актуализации,&#xD;&#xA;•&#x9;логин сотрудника, который внёс изменения в информацию о мобильнике ИК.&#xD;&#xA;&#xD;&#xA;Информация по мобильникам субъектов DWH хранится в таблице DWH.FCT_PROPERTY_VALUE вместе с остальными простыми реквизитами.&#xD;&#xA;&#xD;&#xA;Информация по мобильникам ИК хранится в таблице DWH.KZ_MOB_OPER, также эти данные копируются в DWH.FCT_PROPERTY_VALUE, обновляясь при каждом изменении информации по мобильникам ИК. История измерений мобильников ИК хранится в таблице DWH.KZ_MOB_HIST.&#xD;&#xA;&#xD;&#xA;Основные задачи при расчёте мобильников ИК заключаются в следующем:&#xD;&#xA;•&#x9;выбрать все мобильники привязанных к нему субъектов DWH.&#xD;&#xA;•&#x9;упорядочить их по дате актуальности.&#xD;&#xA;•&#x9;сложить их виды использования из разных СИ.&#xD;&#xA;•&#x9;удалить вид использования со старого мобильника, если этот вид использования закрепляют за другим мобильником данного ИК, либо этот же телефон закрепили за другим ИК.&#xD;&#xA;•&#x9;хранить историю изменения всей информации по мобильнику.&#xD;&#xA;•&#x9;отправлять в СИ информацию о неактуальности мобильного телефона, если этот телефон сохранили и подтвердили другому ИК через веб-интерфейс MDM.&#xD;&#xA;&#xD;&#xA;В текущем разделе описан алгоритм ежедневного расчёта мобильников ИК при загрузке инкремента.&#xD;&#xA;&#xD;&#xA;1. Осуществляется поиск всех мобильников, из новых порций данных в DWH, а также у субъектов, у которых появился/обновился Ключ (см. раздел «Расчёт Ключа субъекта»). Все эти мобильники группируются по ИК, по СИ, к которой относится субъект DWH, по номеру телефона, по дате изменения (DT_REG). При этом виды их использования складываются.&#xD;&#xA;&#xD;&#xA;2. Полученный набор данных сравнивается с историей изменения мобильников ИК, после чего история изменения мобильников ИК корректируется в соответствии вышеперечисленными основными задачами расчёта мобильников ИК.&#xD;&#xA;&#xD;&#xA;3. Самые свежие по дате изменения данные из обновлённой истории изменения мобильников ИК переносятся в DWH.KZ_MOB_OPER.&#xD;&#xA;&#xD;&#xA;4. Изменения в DWH.KZ_MOB_OPER переносятся в DWH.FCT_PROPERTY_VALUE.&#xD;&#xA;"/>
